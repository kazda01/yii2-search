let searchTimeout=null,forcedSearch=!1,lastSearch="";function search(e,t){e.val()!=lastSearch?(lastSearch=e.val(),$.ajax({type:"POST",url:`/${t}/search`,data:{search:`${e.val()}`},beforeSend:function(){$(".search-button>*").hide(),$(".search-button").append('<div class="spinner-border spinner-border-sm" role="status"></div>')},complete:function(){$(".search-button .spinner-border").remove(),$(".search-button>*").show()},success:function(e){$(`#search-widget-${t}`).html(e),$(`#search-widget-${t}`).children().length>0&&($(`#search-widget-${t}`).children().last().removeClass("border-bottom"),$(`#search-widget-${t}`).find(".stretched-link.search-focus").last().attr("data-last","true"),$(`#search-widget-${t}`).find(".stretched-link.search-focus").first().attr("data-first","true")),$(`#search-widget-${t}`).fadeIn()},error:function(e){console.log(e)}})):$(`#search-widget-${t}`).fadeIn()}function try_search(e,t){let s=t.data("search-id");t.val().length>=4||forcedSearch?(13==e.keyCode&&(forcedSearch=!0,clearTimeout(searchTimeout),t.val().length>0&&search(t,s)),t.val().length>0?(clearTimeout(searchTimeout),searchTimeout=setTimeout(()=>{search(t,s)},300)):$(`#search-widget-${s}`).fadeOut()):($(`#search-widget-${s}`).fadeOut(),forcedSearch=!1)}$(".search-button").on("click",function(e){forcedSearch=!0;let t=$(this).next();try_search(e,t),t.focus()}),$(".search-input").on("keyup",function(e){13!=e.keyCode&&try_search(e,$(this))}),$("body").on("keydown",".search-focus.stretched-link, .search-input",function(e){27==e.keyCode?$("input.search-input, .search-widget a").blur():9==e.keyCode&&e.shiftKey||38==e.keyCode?(e.preventDefault(),$(e.target).data("first")?$(this).closest(".search-widget").prev().focus():"A"==$(this).prop("tagName")&&(0!=$(this).parent().prev(".search-result").length?$(this).parent().prev().find(".search-focus.stretched-link").first().focus():$(this).closest(".container-fluid").prev().find(".search-focus.stretched-link").last().focus())):(9==e.keyCode||40==e.keyCode)&&(e.preventDefault(),$(e.target).data("last")?$(".search-focus[data-first='true']").focus():"INPUT"==$(this).prop("tagName")?$(this).next().find(".search-focus.stretched-link").first().focus():0!=$(this).parent().next(".search-result").length?$(this).parent().next().find(".search-focus.stretched-link").first().focus():$(this).closest(".container-fluid").next().find(".search-focus.stretched-link").first().focus())}),$("body").on("focusout","input.search-input, .search-widget a",function(){let e=$(this),t=e.data("search-id");clearTimeout(searchTimeout),setTimeout(function(){$(document.activeElement).hasClass("search-focus")&&("INPUT"!=$(document.activeElement).prop("tagName")||t==$(document.activeElement).data("search-id"))||(e.closest(".input-group").find(".search-widget").fadeOut(),forcedSearch=!1,lastSearch="")},100)}),$("body").on("focus",".search-widget a",function(){$(".search-result").removeClass("focus"),$(this).closest(".search-result").addClass("focus")}),$("body").on("focus",".search-input",function(){$(".search-result").removeClass("focus")});